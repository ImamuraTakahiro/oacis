%h3 List of Analyses
%table.table.table-condensed.analyses_list
  %thead
    %tr
      %th{width: "18px"}
      %th ID
      %th analyzer
      %th parameters
      %th status
      %th created_at
  %tbody
    - analyses.each do |anl|
      %tr
        %td= image_tag("/assets/expand.png", analysis_id: anl.id.to_s, align: "center", state: "close")
        %td= link_to(anl.id, analysis_path(anl))
        - azr = anl.analyzer
        %td= link_to(azr.name, simulator_analyzer_path(azr.simulator, azr))
        %td= anl.parameters.empty? ? '-' : anl.parameters.inspect
        %td= raw(status_label(anl.status))
        %td= anl.created_at

:javascript
  $('.analyses_list').on("click", 'img[analysis_id]', function() {
    if( $(this).attr("state") === "close" ) {
      var tr_element = $(this).closest("tr");
      var analysis_id = $(this).attr("analysis_id");
      var table_cols = tr_element.children("td").length
      $(this).attr("state", "open").attr("src", "/assets/collapse.png")
      $.get("/analyses/" + analysis_id + "/_result", {}, function(data) {
        tr_element.after(
          $("<tr>").attr("id", "result_" + analysis_id).html(
            $("<td>").attr({colspan: table_cols}).html(
              $("<div>").attr("class", "well").html(data)
            )
          )
        );
      });
    }
    else {  // state === "open"
      $(this).attr("state", "close").attr("src", "/assets/expand.png")
      var result_id = "result_" + $(this).attr("analysis_id")
      $(this).closest("tr").siblings("tr#" + result_id).remove()
    }
  });
